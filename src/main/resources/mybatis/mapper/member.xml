<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
<mapper namespace="mybatis.mapper.member"> <!-- 여러 개의 매퍼 중 특정 한 개를 찾을 때 쓰는 것..?/ MemberDao에서 찾을 때 사용하는 이름 -->
										   <!-- return sqlSession.selectList("mybatis.mapper.member.selectAll"); namespace="mybatis.mapper.member"-->
										   
										   
	<!-- <resultMap type="member" id="memVo">
		<result column="id" property="id"/>
		<result column="email" property="email"/>
		<result column="password" property="password"/>
		<result column="name" property="name"/>
		<result column="regdate" property="registerDate"/>
	</resultMap>									 
	
	<sql id="selectAllMember">
		SELECT * FROM membersTbl
	</sql>
	
	
	<select id="selectByEmail" resultMap="memVo" parameterType="String">
		<include refid="selectAllMember" />
		WHERE email=#{email}
	</select>
	
	<select id="selectByRegDate" resultMap="memVo" parameterType="spring.vo.ListCommand">
		<include refid="selectAllMember" />
		WHERE regdate BETWEEN #{from} AND #{to} 
		ORDER BY regdate ASC
	</select>
	
	<insert id="insertMember" parameterType="member">
		INSERT INTO membersTbl 
		VALUES(membersTbl_seq.nextval,#{email},#{password},#{name},sysdate)
	</insert>
	
	<update id="updateMember" parameterType="member">
		UPDATE membersTbl SET name=#{name}, password=#{password} WHERE email=#{email}
	</update>
	 -->
	
	
	
	<!-- 자유게시판 -->
	<select id="selectAllFreeBoard" resultType="freeBoard">
		SELECT * FROM freeBoardTbl WHERE boardCategory!='notice' ORDER BY boardNum DESC
	</select>
	
	<select id="selectByFreeBoardNum" resultType="freeBoard" parameterType="long">
		SELECT * FROM freeBoardTbl WHERE boardNum=#{boardNum}
	</select>
	
	<update id="updateViewCountFreeBoard" parameterType="freeBoard">
		UPDATE freeBoardTbl SET viewCount = #{viewCount}+1 WHERE boardNum=#{boardNum}
	</update>
	
	<update id="updateGoodCountFreeBoard" parameterType="freeBoard">
		UPDATE freeBoardTbl SET good = #{good}+1 WHERE boardNum=#{boardNum}
	</update>
	
	<update id="updateBadCountFreeBoard" parameterType="freeBoard">
		UPDATE freeBoardTbl SET bad = #{bad}+1 WHERE boardNum=#{boardNum}
	</update>
	
	<update id="updateReportCountFreeBoard" parameterType="freeBoard">
		UPDATE freeBoardTbl SET report = #{report}+1 WHERE boardNum=#{boardNum}
	</update>
	
	<select id="selectAllFreeComment" parameterType="long" resultType="freeComment">
		SELECT c.* 
		FROM freeBoardTbl b INNER JOIN freeCommentTbl c
		ON b.boardNum = c.boardNum
		WHERE c.boardNum=#{boardNum}
		ORDER BY c.commentNum ASC
	</select>
	<select id="selectAllFreeComment2" parameterType="String" resultType="freeComment">
		SELECT c.* 
		FROM freeBoardTbl b INNER JOIN freeCommentTbl c
		ON b.boardNum = c.boardNum
		WHERE c.boardNum=#{boardNum}
		ORDER BY c.commentNum DESC
	</select>
	
	<insert id="insertFreeComment" parameterType="freeCommentCommand">
		INSERT INTO freeCommentTbl
		Values(FREECOMMENT_SEQ.nextval,#{boardNum},#{commentContent},#{name},sysdate)
	</insert>
	
	<insert id="insertFreeBoard" parameterType="freeBoardCommand">
		INSERT INTO freeBoardTbl
		VALUES(freeBoard_seq.nextval,#{boardTitle},#{boardContent},#{name},sysdate,#{boardCategory},#{boardUrl},0,0,0,0)
	</insert>
	
	
	<select id="selectDogFreeBoardList" resultType="freeBoard">
		SELECT * FROM freeBoardTbl WHERE boardCategory='dog' AND boardCategory!='notice' ORDER BY boardNum DESC
	</select>
	<select id="selectCatFreeBoardList" resultType="freeBoard">
		SELECT * FROM freeBoardTbl WHERE boardCategory='cat' AND boardCategory!='notice' ORDER BY boardNum DESC
	</select>
	<select id="selectReptileFreeBoardList" resultType="freeBoard">
		SELECT * FROM freeBoardTbl WHERE boardCategory='reptile' AND boardCategory!='notice' ORDER BY boardNum DESC
	</select>
	<select id="selectBirdsFreeBoardList" resultType="freeBoard">
		SELECT * FROM freeBoardTbl WHERE boardCategory='birds' AND boardCategory!='notice' ORDER BY boardNum DESC
	</select>
	<select id="selectFishFreeBoardList" resultType="freeBoard">
		SELECT * FROM freeBoardTbl WHERE boardCategory='fish' AND boardCategory!='notice' ORDER BY boardNum DESC
	</select>
	<select id="selectOtherFreeBoardList" resultType="freeBoard">
		SELECT * FROM freeBoardTbl WHERE boardCategory='other' AND boardCategory!='notice' ORDER BY boardNum DESC
	</select>
	<select id="selectAllNoticeList" resultType="freeBoard">
		SELECT * FROM freeBoardTbl WHERE boardCategory='notice' ORDER BY boardNum DESC
	</select>
	
	
	<!-- 이슈 -->
	<sql id="selectAllIssue">
		SELECT * FROM issueTbl
	</sql>
	
	<select id="selectAllIssueList" resultType="issue">
		SELECT * FROM IssueTbl ORDER BY issueNum DESC
	</select>										   

	<select id="selectByIssueNum" resultType="issue">
		<include refid="selectAllIssue" />
		WHERE issueNum=#{issueNum}
	</select>
	
	<update id="updateViewCount" parameterType="issue">
		UPDATE issueTbl SET viewCount = #{viewCount}+1 WHERE issueNum=#{issueNum}
	</update>

	<select id="selectByIssue" resultType="issue">
		<include refid="selectAllIssue" />
		WHERE issueNum=#{issueNum}
	</select>
	
	<select id="getIssueComments" resultType="issueComment">
		SELECT c.*
		FROM issueTbl i INNER JOIN issueCommentTbl c 
		ON i.issueNum=c.boardNum
		WHERE c.boardNum=#{issueNum} 	
	</select>
	
	<select id="getIssueComments2" parameterType="String" resultType="issueComment">
		SELECT c.*
		FROM issueTbl i INNER JOIN issueCommentTbl c 
		ON i.issueNum=c.boardNum
		WHERE c.boardNum=#{issueNum} 	
		ORDER BY c.commentNum DESC
	</select>
	
	<insert id="insertIssueComment" parameterType="issueComment">
		INSERT INTO issueCommentTbl
		Values(issueComment_seq.nextval,#{boardNum},#{commentContent},#{name},sysdate)
	</insert>
	
	
	<!-- 동물 소개 -->
	<select id="selectAllAniaml" resultType="animalInfo">
		SELECT * FROM animalInfoTbl ORDER BY animalNum DESC
	</select>
	
	<select id="selectByAnimalNum" resultType="animalInfo" parameterType="long">
		SELECT * FROM animalInfoTbl 
 		WHERE animalNum=#{animalNum}
 	</select>
	
	<update id="addViewCount" parameterType="animalInfo"> 
		UPDATE animalInfoTbl SET viewCount = #{viewCount}+1 
		WHERE animalNum=#{animalNum} 
	</update>
	
	<!-- 병원 정보 -->
	<select id="selectAllHospital" resultType="hospitalInfo">
		SELECT * FROM hospitalInfoTbl ORDER BY boardNum ASC
	</select>
	
	<select id="selectByHospitalNum" resultType="hospitalInfo" parameterType="long">
		SELECT * FROM hospitalInfoTbl
 		WHERE boardNum=#{boardNum}
 	</select>
	
	<update id="updateGoodCountHospitalInfo" parameterType="hospitalInfo">
		UPDATE hospitalInfoTbl SET good = #{good}+1 WHERE boardNum=#{boardNum}
	</update>
	
	<update id="updateBadCountHospitalInfo" parameterType="hospitalInfo">
		UPDATE hospitalInfoTbl SET bad = #{bad}+1 WHERE boardNum=#{boardNum}
	</update>
	
	<select id="selectHospitalSeoul" resultType="hospitalInfo">
		SELECT * FROM hospitalInfoTbl WHERE hospitalLoc = '서울'
	</select>
	
	<select id="selectHospitalGyeongi" resultType="hospitalInfo">
		SELECT * FROM hospitalInfoTbl WHERE hospitalLoc = '경기'
	</select>
	
	<select id="selectHospitalIncheon" resultType="hospitalInfo">
		SELECT * FROM hospitalInfoTbl WHERE hospitalLoc = '인천'
	</select>
	
	<select id="selectHospitalDaejeon" resultType="hospitalInfo">
		SELECT * FROM hospitalInfoTbl WHERE hospitalLoc = '대전'
	</select>
	 
	<sql id="selectAllMember">
		select * from userTbl	
	</sql>
	
	<select id="selectAll" resultType="user">
		<include refid="selectAllMember"/>
		order by id ASC
	</select>
	
	<select id="selectByEmail" resultType="user" parameterType="String">
		<include refid="selectAllMember"/>
		where email=#{email}
	</select>
	
	<select id="selectById" resultType="user" parameterType="String">
		<include refid="selectAllMember"/>
		where id=#{id}
	</select>
	
	<insert id="insertMember" parameterType="user">
		insert into userTbl
		values(#{id},#{password},#{name},#{email},#{phone},0)
	</insert>
	
	

	<!-- 관리자 회원관리 -->
	<select id="memberList" resultType="user">
		<include refid="selectAllMember"/>
		WHERE admin=0
	</select>
	
	<select id="searchMember" resultType="user">
		<include refid="selectAllMember"/>
		WHERE name=#{search} OR
		id=#{search} OR
		email=#{search} OR
		phone=#{search}
	</select>
	
	<select id="selectByMemberName" resultType="user">
		<include refid="selectAllMember"/>
		WHERE name=#{name}
	</select>
	
	<select id="getboardList" resultType="freeBoard">
		SELECT f.boardNum, f.boardTitle, f.writeDate, f.viewCount
		FROM userTbl u, freeboardTbl f
		WHERE u.name=#{name} AND u.name=f.name
	</select>
	
	<delete id="boardDelete" parameterType="long" timeout="20">
		DELETE FROM freeBoardTbl WHERE boardNum=#{boardNum}
	</delete>
	
	<select id="selectName" parameterType="long" resultType="String">
		select name FROM freeBoardTbl WHERE boardNum=#{boardNum}
	</select>

	<!-- 매니저페이지 -->
	<insert id="insertIssueBoard" parameterType="issueBoardCommand">
		INSERT INTO issueTbl
		VALUES (ISSUEBOARD_SEQ.nextval,#{issueTitle},#{issueContent},#{name},#{issueUrl},sysdate,0)
	</insert>
	<insert id="insertHospitalInfo" parameterType="hospitalInfoCommand">
		INSERT INTO hospitalInfoTbl
		VALUES (HOSPITALINFO_SEQ.nextval,#{hospitalName},#{hospitalLoc},#{hospitalTel},#{hospitalInfo},0,0,#{name},#{detailedAddress})
	</insert>

	
	
</mapper>